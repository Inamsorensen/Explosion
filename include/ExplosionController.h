#ifndef EXPLOSIONCONTROLLER
#define EXPLOSIONCONTROLLER

#include "Emitter.h"
#include "Grid.h"
#include "AlembicExport.h"

/// @brief ExplosionController.h
/// Control center for the explosion simulation
/// Contains all user-defineable simulation parameters
/// Author: Ina M. Sorensen
/// Date: 27.05.16
/// Implementation based on the code by
/// Christian Miller (2007). Realtime Explosion Simulation [online].
/// [Accessed May 2016]. Available from: <http://www.cs.utexas.edu/~ckm/explosion/>.

class ExplosionController
{
public:
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Get explosion controller instance
  //----------------------------------------------------------------------------------------------------------------------
  static ExplosionController* instance();

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Update explosion
  //----------------------------------------------------------------------------------------------------------------------
  void update();
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Render explosion
  //----------------------------------------------------------------------------------------------------------------------
  void render(ngl::Mat4 _ModelMatrix_Camera);

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Function to turn off alembic export
  //----------------------------------------------------------------------------------------------------------------------
  inline void toggleAlembicExport(){m_export^=true;}
//  inline void toggleAlembicExport(){m_export=false;}

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Set rendering variables
  //----------------------------------------------------------------------------------------------------------------------
  void setRenderVariables(ngl::Camera* _camera, std::string _shaderName);

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Get grid size and position to enable drawing of bounding box
  //----------------------------------------------------------------------------------------------------------------------
  inline ngl::Vec3 getGridPosition(){return m_gridPosition;}
  inline float getGridSize(){return m_gridSize;}


private:
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Explosion controller constructor
  //----------------------------------------------------------------------------------------------------------------------
  ExplosionController();
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Explosion controller instance pointer
  //----------------------------------------------------------------------------------------------------------------------
  static ExplosionController* m_instance;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Pointer to emitter
  //----------------------------------------------------------------------------------------------------------------------
  Emitter* m_emitter;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Pointer to grid
  //----------------------------------------------------------------------------------------------------------------------
  Grid* m_grid;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Pointer to camera
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Camera* m_camera;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Shader name
  //----------------------------------------------------------------------------------------------------------------------
  std::string m_shaderName;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Timer setup for simulation
  //----------------------------------------------------------------------------------------------------------------------
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Time step of simulation
  //----------------------------------------------------------------------------------------------------------------------
  float m_simTimeStep;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Total elapsed time of simulation
  //----------------------------------------------------------------------------------------------------------------------
  float m_simElapsedTime;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Number of frames in simulation
  //----------------------------------------------------------------------------------------------------------------------
  int m_noFrames;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Set up for alembic export
  //----------------------------------------------------------------------------------------------------------------------
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Export alembic yes/no
  //----------------------------------------------------------------------------------------------------------------------
  bool m_export;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Grid-fluid parameters
  //----------------------------------------------------------------------------------------------------------------------
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Grid position
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Vec3 m_gridPosition;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Grid/bounding box size (set as cube so equal size in all directions)
  //----------------------------------------------------------------------------------------------------------------------
  float m_gridSize;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Number of cells along one of the lengths of the grid (same for the other two). Total number of cells is m_noCell^3
  //----------------------------------------------------------------------------------------------------------------------
  int m_noCells;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Noise constant
  //----------------------------------------------------------------------------------------------------------------------
  float m_noiseConstant;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Vorticity constant
  //----------------------------------------------------------------------------------------------------------------------
  float m_vorticityConstant;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Cooling constant. Heat given off to the environment
  //----------------------------------------------------------------------------------------------------------------------
  float m_coolingConstant;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Buoyancy constant. The amount of effect of temperature on fluid velocity
  //----------------------------------------------------------------------------------------------------------------------
  float m_buoyancyConstant;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Ambient temperature. Set to 20C=293K, ie. in Kelvin
  //----------------------------------------------------------------------------------------------------------------------
  float m_ambientTemp;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Thermal conductivity. Should give how much diffusion of temperature from/through the fluid
  //----------------------------------------------------------------------------------------------------------------------
  float m_thermalConductivity;


  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Explosion parameters
  //----------------------------------------------------------------------------------------------------------------------
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Explosion temperature in Kelvin
  //----------------------------------------------------------------------------------------------------------------------
  float m_explosionTemperature;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Explosion divergence contribution
  //----------------------------------------------------------------------------------------------------------------------
  float m_explosionDivergence;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Explosion origin
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Vec3 m_explosionOrigin;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Radius of exploding sphere
  //----------------------------------------------------------------------------------------------------------------------
  float m_explosionRadius;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Emitter parameters
  //----------------------------------------------------------------------------------------------------------------------
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Position of emitter
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Vec3 m_emitterPosition;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Emitter radius
  //----------------------------------------------------------------------------------------------------------------------
  float m_emitterRadius;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Total number of particles
  //----------------------------------------------------------------------------------------------------------------------
  int m_noParticles;

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle parameters
  //----------------------------------------------------------------------------------------------------------------------
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle mass
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleMass;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Randomisation of mass
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleMassRandomisation;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle radius
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleRadius;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Initial particle velocity
  //----------------------------------------------------------------------------------------------------------------------
  ngl::Vec3 m_particleInitVelocity;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Particle drag constant
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleDragConstant;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Initial particle temperature
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleInitTemperature;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Threshold above which fuel ignites
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleBurnThreshold;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Thermal conductivity between air and fuel
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleThermalConductivity;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Rate at which fuel particles burn, ie. mass combusted per second
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleBurnRate;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Thermal mass of particle
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleThermalMass;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Heat released per unit combusted mass of fuel
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleHeatRelease;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Gas volume released per unit combusted mass of fuel
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleVolumeRelease;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Threshold above which fuel particle turns to soot
  //----------------------------------------------------------------------------------------------------------------------
  float m_particleSootThreshold;

};

#endif // EXPLOSIONCONTROLLER

